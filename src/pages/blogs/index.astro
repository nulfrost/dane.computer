---
import Layout from "@layouts/Layout.astro";
import BlogPost from "@components/BlogPost.astro";
import { getCollection } from "astro:content";

const blogs = await getCollection("blogs");
const documents = await getCollection("documents");

// Combine both collections and sort by publishedAt
const allPosts = [
	...blogs.map((blog) => ({
		...blog,
		data: {
			...blog.data,
			// Ensure publishedAt is a Date object for consistent sorting
			publishedAt: new Date(blog.data.publishedAt),
		},
	})),
	...documents.map((document) => ({
		...document,
		data: {
			...document.data,
			// Ensure publishedAt is a Date object for consistent sorting
			publishedAt: new Date(document.data.publishedAt),
		},
	})),
].sort((a, b) => b.data.publishedAt.valueOf() - a.data.publishedAt.valueOf());
---

<Layout
    title="Dane's Space | Blog"
    description="Where I write about things I've learned or found interesting"
>
    <h1 class="mt-4 mb-4 text-2xl font-bold text-snes-black">Blog</h1>
    <ul class="space-y-4">
        {
            allPosts.map((post) => (
                <BlogPost
                    title={post.data.title}
                    slug={post.id}
                    publishedAt={post.data.publishedAt.toISOString()}
                />
            ))
        }
    </ul>
</Layout>
